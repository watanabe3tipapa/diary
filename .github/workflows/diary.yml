name: Create Diary
on:
  schedule:
    - cron: '0 0 * * *'   # UTC 00:00 daily (adjust if needed)
  workflow_dispatch:

jobs:
  create-diary:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Create directories
        run: mkdir -p diary templates

      - name: Add template if missing
        run: |
          if [ ! -f templates/diary.md ]; then
            cat > templates/diary.md <<'MD'
---
title: "{{date}}"
date: "{{date}}"
tags: []
mood: neutral
---

# {{date}}

## 今日のトピック
- 

## 今日の学び
- 

## 今日の TODO / リンク
- 

## 振り返り
- 
MD
          fi

      - name: Generate diary
        env:
          GIT_AUTHOR_NAME: github-actions
          GIT_AUTHOR_EMAIL: actions@github.com
        run: |
          DATE=$(date -u +%F)
          TARGET="diary/$DATE.md"
          if [ -f "$TARGET" ]; then
            echo "Already exists: $TARGET"
            exit 0
          fi
          sed "s/{{date}}/$DATE/g" templates/diary.md > "$TARGET"
          git add "$TARGET"
          git commit -m "chore(diary): add $DATE.md" || echo "no changes to commit"
          git push origin HEAD

